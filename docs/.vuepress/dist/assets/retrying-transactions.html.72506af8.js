import{_ as d,r as o,o as p,c as u,a as n,b as e,w as t,F as h,d as a,e as c}from"./app.1656ed2a.js";var _="/assets/tx-journey.dd6310be.png",m="/assets/tpu-jito-labs.8bb32fb6.png",b="/assets/dropped-via-rpc-pool.8d1ce9af.png",k="/assets/dropped-minority-fork-pre-process.555653e1.png",f="/assets/dropped-minority-fork-post-process.48c3c955.png";const g={},v=n("h1",{id:"reintentando-transacciones",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#reintentando-transacciones","aria-hidden":"true"},"#"),a(" Reintentando Transacciones")],-1),y=a("En algunas ocasiones, una transacci\xF3n aparentemente v\xE1lida puede descartarse antes de que se incluya en un bloque. Esto ocurre con mayor frecuencia durante los per\xEDodos de congesti\xF3n de la red, cuando un nodo RPC no puede retransmitir la transacci\xF3n al "),q={href:"https://docs.solana.com/terminology#leader",target:"_blank",rel:"noopener noreferrer"},w=a("l\xEDder"),P=a(". Para un usuario final, puede parecer que su transacci\xF3n desaparece por completo. Si bien los nodos RPC est\xE1n equipados con un algoritmo de retransmisi\xF3n gen\xE9rico, los desarrolladores de aplicaciones tambi\xE9n pueden desarrollar su propia l\xF3gica de retransmisi\xF3n personalizada."),C=c('<h2 id="hechos" tabindex="-1"><a class="header-anchor" href="#hechos" aria-hidden="true">#</a> Hechos</h2><div class="custom-container tip"><p class="custom-container-title">Hoja de hechos</p><ul><li>Los nodos RPC intentar\xE1n retransmitir transacciones usando un algoritmo gen\xE9rico</li><li>Los desarrolladores de aplicaciones pueden implementar su propia l\xF3gica de retransmisi\xF3n personalizada</li><li>Los desarrolladores deben aprovechar el par\xE1metro <code>maxRetries</code> en el m\xE9todo JSON-RPC <code>sendTransaction</code></li><li>Los desarrolladores deben habilitar las comprobaciones previas para generar errores antes de que se env\xEDen las transacciones.</li><li>Antes de volver a firmar cualquier transacci\xF3n, es <strong>muy importante</strong> asegurarse de que el blockhash de la transacci\xF3n inicial haya expirado</li></ul></div><h2 id="el-viaje-de-una-transaccion" tabindex="-1"><a class="header-anchor" href="#el-viaje-de-una-transaccion" aria-hidden="true">#</a> El viaje de una transacci\xF3n</h2><h3 id="como-los-clientes-envian-transacciones" tabindex="-1"><a class="header-anchor" href="#como-los-clientes-envian-transacciones" aria-hidden="true">#</a> C\xF3mo los clientes env\xEDan transacciones</h3><p>En Solana no existe el concepto de mempool. Todas las transacciones, ya sea que se inicien mediante programaci\xF3n o por un usuario final, se enrutan de manera eficiente a los l\xEDderes para que puedan procesarse en un bloque. Hay dos formas principales en las que se puede enviar una transacci\xF3n a los l\xEDderes:</p>',5),x=a("Por proxy a trav\xE9s de un servidor RPC y el m\xE9todo JSON-RPC "),R={href:"https://docs.solana.com/developing/clients/jsonrpc-api#sendtransaction",target:"_blank",rel:"noopener noreferrer"},T=a("sendTransaction"),L=a("Directamente a los l\xEDderes a trav\xE9s de un "),S={href:"https://docs.rs/solana-client/1.7.3/solana_client/tpu_client/index.html",target:"_blank",rel:"noopener noreferrer"},j=a("Cliente TPU"),E=n("p",null,"La gran mayor\xEDa de los usuarios finales enviar\xE1n transacciones a trav\xE9s de un servidor RPC. Cuando un cliente env\xEDa una transacci\xF3n, el nodo RPC receptor intentar\xE1, a su vez, transmitir la transacci\xF3n a los l\xEDderes actuales y siguientes. Hasta que la transacci\xF3n sea procesada por un l\xEDder, no hay registro de la transacci\xF3n fuera de lo que conocen el cliente y los nodos RPC de retransmisi\xF3n. En el caso de un cliente de TPU, la retransmisi\xF3n y el reenv\xEDo de l\xEDder son manejados completamente por el software del cliente.",-1),B=n("p",null,[n("img",{src:_,alt:"Viaje de una transacci\xF3n"})],-1),z=n("h3",{id:"como-transmiten-las-transacciones-los-nodos-rpc",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#como-transmiten-las-transacciones-los-nodos-rpc","aria-hidden":"true"},"#"),a(" C\xF3mo transmiten las transacciones los nodos RPC")],-1),A=a("Despu\xE9s de que un nodo RPC recibe una transacci\xF3n a trav\xE9s de "),U=n("code",null,"sendTransaction",-1),V=a(", convertir\xE1 la transacci\xF3n en un paquete "),H={href:"https://en.wikipedia.org/wiki/User_Datagram_Protocol",target:"_blank",rel:"noopener noreferrer"},D=a("UDP"),K=a(" antes de reenviarlo a los l\xEDderes relevantes. UDP permite que los validadores se comuniquen r\xE1pidamente entre s\xED, pero no ofrece ninguna garant\xEDa con respecto a la entrega de transacciones."),N=a("Debido a que el cronograma de l\xEDderes de Solana se conoce antes de cada "),O={href:"https://docs.solana.com/terminology#epoch",target:"_blank",rel:"noopener noreferrer"},M=a("\xE9poca"),I=a(" (~2 d\xEDas), un nodo RPC transmitir\xE1 su transacci\xF3n directamente a los l\xEDderes actuales y siguientes. Esto contrasta con otros protocolos gossip como Ethereum que propagan transacciones de forma aleatoria y amplia en toda la red. De forma predeterminada, los nodos RPC intentar\xE1n reenviar transacciones a los l\xEDderes cada dos segundos hasta que finalice la transacci\xF3n o expire el blockhash de la transacci\xF3n (150 bloques o ~1 minuto 19 segundos al momento de escribir este art\xEDculo). Si el tama\xF1o de la cola de retransmisi\xF3n pendiente es superior a "),J={href:"https://github.com/solana-labs/solana/blob/bfbbc53dac93b3a5c6be9b4b65f679fdb13e41d9/send-transaction-service/src/send_transaction_service.rs#L20",target:"_blank",rel:"noopener noreferrer"},F=a("10 000 transacciones"),G=a(", las transacciones enviadas recientemente se descartar\xE1n. Hay "),W={href:"https://github.com/solana-labs/solana/blob/bfbbc53dac93b3a5c6be9b4b65f679fdb13e41d9/validator/src/main.rs#L1172",target:"_blank",rel:"noopener noreferrer"},Y=a("argumentos"),Q=a(" de l\xEDnea de comandos que los operadores de RPC pueden ajustar para cambiar el comportamiento predeterminado de este reintento l\xF3gica."),X=a("Cuando un nodo RPC transmite una transacci\xF3n, intentar\xE1 reenviar la transacci\xF3n a la "),Z={href:"https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/validator.rs#L867",target:"_blank",rel:"noopener noreferrer"},$=a("Unidad de procesamiento de transacciones (TPU)"),nn=a(". The TPU processes transactions in five distinct phases:"),an={href:"https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/fetch_stage.rs#L21",target:"_blank",rel:"noopener noreferrer"},en=a("Etapa de Fetch"),sn={href:"https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/tpu.rs#L91",target:"_blank",rel:"noopener noreferrer"},on=a("Etapa de SigVerify"),tn={href:"https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/banking_stage.rs#L249",target:"_blank",rel:"noopener noreferrer"},cn=a("Etapa de Banking"),rn={href:"https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/poh/src/poh_service.rs",target:"_blank",rel:"noopener noreferrer"},ln=a("Servicios Proof of History"),dn={href:"https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/tpu.rs#L136",target:"_blank",rel:"noopener noreferrer"},pn=a("Etapa de Broadcast"),un=n("p",null,[n("img",{src:m,alt:"TPU Overview"}),n("small",{style:{display:"block","text-align":"center"}},"Image Courtesy of Jito Labs")],-1),hn=n("p",null,"De estas cinco fases, la etapa Fetch es responsable de recibir transacciones. Dentro de la etapa de b\xFAsqueda, los validadores clasificar\xE1n las transacciones entrantes seg\xFAn tres puertos:",-1),_n={href:"https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/gossip/src/contact_info.rs#L27",target:"_blank",rel:"noopener noreferrer"},mn=a("tpu"),bn=a(" maneja transacciones regulares como transferencias de tokens, mint de NFT e instrucciones de programas"),kn={href:"https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/gossip/src/contact_info.rs#L31",target:"_blank",rel:"noopener noreferrer"},fn=a("tpu_vote"),gn=a(" se enfoca exclusivamente en transacciones de votaci\xF3n"),vn={href:"https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/gossip/src/contact_info.rs#L29",target:"_blank",rel:"noopener noreferrer"},yn=a("tpu_forwards"),qn=a(" reenv\xEDa paquetes sin procesar al siguiente l\xEDder si el l\xEDder actual no puede procesar todas las transacciones"),wn=a("Para obtener m\xE1s informaci\xF3n sobre la TPU, consulte "),Pn={href:"https://jito-labs.medium.com/solana-validator-101-transaction-processing-90bcdc271143",target:"_blank",rel:"noopener noreferrer"},Cn=a("este excelente art\xEDculo de Jito Labs"),xn=a("."),Rn=n("h2",{id:"como-se-caen-las-transacciones",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#como-se-caen-las-transacciones","aria-hidden":"true"},"#"),a(" C\xF3mo se caen las transacciones")],-1),Tn=n("p",null,"A lo largo del viaje de una transacci\xF3n, hay algunos escenarios en los que la transacci\xF3n puede eliminarse involuntariamente de la red.",-1),Ln=n("h3",{id:"antes-de-que-se-procese-una-transaccion",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#antes-de-que-se-procese-una-transaccion","aria-hidden":"true"},"#"),a(" Antes de que se procese una transacci\xF3n")],-1),Sn=a("Si la red descarta una transacci\xF3n, lo m\xE1s probable es que lo haga antes de que un l\xEDder procese la transacci\xF3n. La "),jn={href:"https://en.wikipedia.org/wiki/Packet_loss",target:"_blank",rel:"noopener noreferrer"},En=a("p\xE9rdida de paquetes"),Bn=a(" UDP es la raz\xF3n m\xE1s simple por la que esto puede ocurrir. En momentos de intensa carga de la red, tambi\xE9n es posible que los validadores se vean abrumados por la gran cantidad de transacciones necesarias para el procesamiento. Si bien los validadores est\xE1n equipados para reenviar transacciones excedentes a trav\xE9s de "),zn=n("code",null,"tpu_forwards",-1),An=a(", existe un l\xEDmite en la cantidad de datos que se pueden "),Un={href:"https://github.com/solana-labs/solana/blob/master/core/src/banking_stage.rs#L389",target:"_blank",rel:"noopener noreferrer"},Vn=a("reenviar"),Hn=a(". Adem\xE1s, cada reenv\xEDo est\xE1 limitado a un solo salto entre validadores. Es decir, las transacciones recibidas en el puerto "),Dn=n("code",null,"tpu_forwards",-1),Kn=a(" no se reenv\xEDan a otros validadores."),Nn=a("Tambi\xE9n hay dos razones menos conocidas por las que una transacci\xF3n puede descartarse antes de que se procese. El primer escenario implica transacciones que se env\xEDan a trav\xE9s de un grupo de RPC. Ocasionalmente, parte del grupo de RPC puede estar lo suficientemente por delante del resto del grupo. Esto puede causar problemas cuando se requiere que los nodos dentro del grupo trabajen juntos. En este ejemplo, el "),On={href:"https://docs.solana.com/developing/programming-model/transactions#recent-blockhash",target:"_blank",rel:"noopener noreferrer"},Mn=a("recentBlockhash"),In=a(" de la transacci\xF3n se consulta desde la parte avanzada del grupo (Backend A). Cuando la transacci\xF3n se env\xEDa a la parte rezagada del grupo (Backend B), los nodos no reconocer\xE1n el blockhash avanzado y descartar\xE1n la transacci\xF3n. Esto se puede detectar al enviar la transacci\xF3n si los desarrolladores habilitan las "),Jn={href:"https://docs.solana.com/developing/clients/jsonrpc-api#sendtransaction",target:"_blank",rel:"noopener noreferrer"},Fn=a("comprobaciones previas"),Gn=a(" en "),Wn=n("code",null,"sendTransaction",-1),Yn=a("."),Qn=c('<p><img src="'+b+'" alt="Caidas via RPC Pool"></p><p>Las bifurcaciones de red temporales tambi\xE9n pueden resultar en transacciones descartadas. Si un validador tarda en reproducir sus bloques dentro de la etapa bancaria, puede terminar creando una bifurcaci\xF3n minoritaria. Cuando un cliente crea una transacci\xF3n, es posible que la transacci\xF3n haga referencia a un <code>recentBlockhash</code> que solo existe en la bifurcaci\xF3n minoritaria. Una vez que se env\xEDa la transacci\xF3n, el cl\xFAster puede cambiar su bifurcaci\xF3n minoritaria antes de que se procese la transacci\xF3n. En este escenario, la transacci\xF3n se descarta debido a que no se encuentra el blockhash.</p><p><img src="'+k+'" alt="Ca\xEDdas debido a una Bifurcaci\xF3n Minoritaria (Antes de procesar)"></p><h3 id="despues-de-que-se-procese-una-transaccion-y-antes-de-que-finalice" tabindex="-1"><a class="header-anchor" href="#despues-de-que-se-procese-una-transaccion-y-antes-de-que-finalice" aria-hidden="true">#</a> Despu\xE9s de que se procese una transacci\xF3n y antes de que finalice</h3><p>En el caso de que una transacci\xF3n haga referencia a un <code>recentBlockhash</code> de una bifurcaci\xF3n minoritaria, todav\xEDa es posible que se procese la transacci\xF3n. En este caso, sin embargo, ser\xEDa procesado por el l\xEDder en la bifurcaci\xF3n minoritaria. Cuando este l\xEDder intente compartir sus transacciones procesadas con el resto de la red, no lograr\xE1 llegar a un consenso con la mayor\xEDa de los validadores que no reconocen la bifurcaci\xF3n minoritaria. En este momento, la transacci\xF3n se cancelar\xEDa antes de que pudiera finalizarse.</p><p><img src="'+f+'" alt="Ca\xEDdas debido a una Bifurcaci\xF3n Minoritaria (Antes de procesar)"></p><h2 id="manejo-de-transacciones-descartadas" tabindex="-1"><a class="header-anchor" href="#manejo-de-transacciones-descartadas" aria-hidden="true">#</a> Manejo de transacciones descartadas</h2><p>Si bien los nodos RPC intentar\xE1n retransmitir las transacciones, el algoritmo que emplean es gen\xE9rico y, a menudo, inadecuado para las necesidades de aplicaciones espec\xEDficas. Para prepararse para tiempos de congesti\xF3n de la red, los desarrolladores de aplicaciones deben personalizar su propia l\xF3gica de retransmisi\xF3n.</p><h3 id="una-mirada-en-profundidad-a-sendtransaction" tabindex="-1"><a class="header-anchor" href="#una-mirada-en-profundidad-a-sendtransaction" aria-hidden="true">#</a> Una mirada en profundidad a sendTransaction</h3><p>Cuando se trata de enviar transacciones, el m\xE9todo RPC <code>sendTransaction</code> es la principal herramienta disponible para los desarrolladores. <code>sendTransaction</code> solo es responsable de transmitir una transacci\xF3n de un cliente a un nodo RPC. Si el nodo recibe la transacci\xF3n, <code>sendTransaction</code> devolver\xE1 la identificaci\xF3n de la transacci\xF3n que se puede usar para rastrear la transacci\xF3n. Una respuesta satisfactoria no indica si el cl\xFAster procesar\xE1 o finalizar\xE1 la transacci\xF3n.</p>',10),Xn={class:"custom-container tip"},Zn=n("p",{class:"custom-container-title"},"TIP",-1),$n=n("h4",{id:"parametros-de-la-solicitud",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#parametros-de-la-solicitud","aria-hidden":"true"},"#"),a(" Par\xE1metros de la solicitud")],-1),na=n("li",null,[n("code",null,"transaction"),a(": "),n("code",null,"string"),a(" - transacci\xF3n totalmente firmada, como cadena codificada")],-1),aa=a("(opcional) "),ea=n("code",null,"configuration object",-1),sa=a(": "),oa=n("code",null,"object",-1),ta=n("li",null,[n("code",null,"skipPreflight"),a(": "),n("code",null,"boolean"),a(" - si es verdadero, omita las verificaciones de transacciones previas al vuelo (predeterminado: falso)")],-1),ca=a("(opcional) "),ra=n("code",null,"preflightCommitment",-1),ia=a(": "),la=n("code",null,"string",-1),da=a(" - "),pa={href:"https://docs.solana.com/developing/clients/jsonrpc-api#configuring-state-commitment",target:"_blank",rel:"noopener noreferrer"},ua=a("Commitment"),ha=a(' nivel a usar para simulaciones de verificaci\xF3n previa contra la ranura del banco (predeterminado: "finalizado").'),_a=n("li",null,[a("(opcional) "),n("code",null,"encoding"),a(": "),n("code",null,"string"),a(' - Codificaci\xF3n utilizada para los datos de transacci\xF3n. O "base58" (lento) o "base64". (predeterminado: "base58").')],-1),ma=n("li",null,[a("(opcional) "),n("code",null,"maxRetries"),a(": "),n("code",null,"usize"),a(" - N\xFAmero m\xE1ximo de veces para que el nodo RPC vuelva a intentar enviar la transacci\xF3n al l\xEDder. Si no se proporciona este par\xE1metro, el nodo RPC volver\xE1 a intentar la transacci\xF3n hasta que finalice o hasta que caduque el blockhash.")],-1),ba=n("h4",{id:"respuesta",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#respuesta","aria-hidden":"true"},"#"),a(" Respuesta")],-1),ka=n("code",null,"transaction id",-1),fa=a(": "),ga=n("code",null,"string",-1),va=a(" - Primera firma de transacci\xF3n incrustada en la transacci\xF3n como cadena codificada en base 58. Este ID de transacci\xF3n se puede usar con "),ya={href:"https://docs.solana.com/developing/clients/jsonrpc-api#getsignaturestatuses",target:"_blank",rel:"noopener noreferrer"},qa=a("getSignatureStatuses"),wa=a(" para buscar actualizaciones de estado."),Pa=n("h2",{id:"personalizacion-de-la-logica-de-retransmision",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#personalizacion-de-la-logica-de-retransmision","aria-hidden":"true"},"#"),a(" Personalizaci\xF3n de la l\xF3gica de retransmisi\xF3n")],-1),Ca=a("Para desarrollar su propia l\xF3gica de retransmisi\xF3n, los desarrolladores deber\xEDan aprovechar el par\xE1metro "),xa=n("code",null,"maxRetries",-1),Ra=a(" de "),Ta=n("code",null,"sendTransaction",-1),La=a(". Si se proporciona, "),Sa=n("code",null,"maxRetries",-1),ja=a(" anular\xE1 la l\xF3gica de reintento predeterminada de un nodo RPC, lo que permitir\xE1 a los desarrolladores controlar manualmente el proceso de reintento "),Ea={href:"https://github.com/solana-labs/solana/blob/98707baec2385a4f7114d2167ef6dfb1406f954f/validator/src/principal.rs#L1258-L1274",target:"_blank",rel:"noopener noreferrer"},Ba=a("dentro de l\xEDmites razonables"),za=a("."),Aa=a("Un patr\xF3n com\xFAn para volver a intentar transacciones manualmente consiste en almacenar temporalmente "),Ua=n("code",null,"lastValidBlockHeight",-1),Va=a(" que proviene de "),Ha={href:"https://docs.solana.com/developing/clients/jsonrpc-api#getlatestblockhash",target:"_blank",rel:"noopener noreferrer"},Da=a("getLatestBlockhash"),Ka=a(". Una vez almacenada, una aplicaci\xF3n puede "),Na={href:"https://docs.solana.com/developing/clients/jsonrpc-api#getblockheight",target:"_blank",rel:"noopener noreferrer"},Oa=a("obtener la altura del bloque del cl\xFAster"),Ma=a(" y volver a intentar manualmente la transacci\xF3n en un intervalo apropiado. En tiempos de congesti\xF3n de la red, es ventajoso establecer "),Ia=n("code",null,"maxRetries",-1),Ja=a(" en 0 y retransmitir manualmente a trav\xE9s de un algoritmo personalizado. Si bien algunas aplicaciones pueden emplear un algoritmo de "),Fa={href:"https://en.wikipedia.org/wiki/Exponential_backoff",target:"_blank",rel:"noopener noreferrer"},Ga=a("retroceso exponencial"),Wa=a(", otras como "),Ya={href:"https://www.mango.markets/",target:"_blank",rel:"noopener noreferrer"},Qa=a("Mango"),Xa=a(" optan por "),Za={href:"https://github.com/blockworks-foundation/mango-ui/blob/b6abfc6c13b71fc17ebbe766f50b8215fa1ec54f/src/utils/send.tsx#L713",target:"_blank",rel:"noopener noreferrer"},$a=a("reenviar continuamente"),ne=a(" transacciones a un intervalo constante hasta que se agote el tiempo de espera."),ae=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"import"),a(),n("span",{class:"token punctuation"},"{"),a(`
  Keypair`),n("span",{class:"token punctuation"},","),a(`
  Connection`),n("span",{class:"token punctuation"},","),a(`
  `),n("span",{class:"token constant"},"LAMPORTS_PER_SOL"),n("span",{class:"token punctuation"},","),a(`
  SystemProgram`),n("span",{class:"token punctuation"},","),a(`
  Transaction`),n("span",{class:"token punctuation"},","),a(`
`),n("span",{class:"token punctuation"},"}"),a(),n("span",{class:"token keyword"},"from"),a(),n("span",{class:"token string"},'"@solana/web3.js"'),n("span",{class:"token punctuation"},";"),a(`
`),n("span",{class:"token keyword"},"import"),a(),n("span",{class:"token operator"},"*"),a(),n("span",{class:"token keyword"},"as"),a(" nacl "),n("span",{class:"token keyword"},"from"),a(),n("span",{class:"token string"},'"tweetnacl"'),n("span",{class:"token punctuation"},";"),a(`

`),n("span",{class:"token keyword"},"const"),a(),n("span",{class:"token function-variable function"},"sleep"),a(),n("span",{class:"token operator"},"="),a(),n("span",{class:"token keyword"},"async"),a(),n("span",{class:"token punctuation"},"("),a("ms"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token builtin"},"number"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token keyword"},"return"),a(),n("span",{class:"token keyword"},"new"),a(),n("span",{class:"token class-name"},[n("span",{class:"token builtin"},"Promise")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),a("r"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token function"},"setTimeout"),n("span",{class:"token punctuation"},"("),a("r"),n("span",{class:"token punctuation"},","),a(" ms"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),a(`

`),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"async"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token keyword"},"const"),a(" payer "),n("span",{class:"token operator"},"="),a(" Keypair"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"generate"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
  `),n("span",{class:"token keyword"},"const"),a(" toAccount "),n("span",{class:"token operator"},"="),a(" Keypair"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"generate"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),a("publicKey"),n("span",{class:"token punctuation"},";"),a(`

  `),n("span",{class:"token keyword"},"const"),a(" connection "),n("span",{class:"token operator"},"="),a(),n("span",{class:"token keyword"},"new"),a(),n("span",{class:"token class-name"},"Connection"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"http://127.0.0.1:8899"'),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token string"},'"confirmed"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`

  `),n("span",{class:"token keyword"},"const"),a(" airdropSignature "),n("span",{class:"token operator"},"="),a(),n("span",{class:"token keyword"},"await"),a(" connection"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"requestAirdrop"),n("span",{class:"token punctuation"},"("),a(`
    payer`),n("span",{class:"token punctuation"},"."),a("publicKey"),n("span",{class:"token punctuation"},","),a(`
    `),n("span",{class:"token constant"},"LAMPORTS_PER_SOL"),a(`
  `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`

  `),n("span",{class:"token keyword"},"await"),a(" connection"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"confirmTransaction"),n("span",{class:"token punctuation"},"("),a("airdropSignature"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`

  `),n("span",{class:"token keyword"},"const"),a(" blockhashResponse "),n("span",{class:"token operator"},"="),a(),n("span",{class:"token keyword"},"await"),a(" connection"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getLatestBlockhashAndContext"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
  `),n("span",{class:"token keyword"},"const"),a(" lastValidBlockHeight "),n("span",{class:"token operator"},"="),a(" blockhashResponse"),n("span",{class:"token punctuation"},"."),a("context"),n("span",{class:"token punctuation"},"."),a("slot "),n("span",{class:"token operator"},"+"),a(),n("span",{class:"token number"},"150"),n("span",{class:"token punctuation"},";"),a(`

  `),n("span",{class:"token keyword"},"const"),a(" transaction "),n("span",{class:"token operator"},"="),a(),n("span",{class:"token keyword"},"new"),a(),n("span",{class:"token class-name"},"Transaction"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),a(`
    feePayer`),n("span",{class:"token operator"},":"),a(" payer"),n("span",{class:"token punctuation"},"."),a("publicKey"),n("span",{class:"token punctuation"},","),a(`
    blockhash`),n("span",{class:"token operator"},":"),a(" blockhashResponse"),n("span",{class:"token punctuation"},"."),a("value"),n("span",{class:"token punctuation"},"."),a("blockhash"),n("span",{class:"token punctuation"},","),a(`
    lastValidBlockHeight`),n("span",{class:"token operator"},":"),a(" lastValidBlockHeight"),n("span",{class:"token punctuation"},","),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),a(`
    SystemProgram`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"transfer"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),a(`
      fromPubkey`),n("span",{class:"token operator"},":"),a(" payer"),n("span",{class:"token punctuation"},"."),a("publicKey"),n("span",{class:"token punctuation"},","),a(`
      toPubkey`),n("span",{class:"token operator"},":"),a(" toAccount"),n("span",{class:"token punctuation"},","),a(`
      lamports`),n("span",{class:"token operator"},":"),a(),n("span",{class:"token number"},"1000000"),n("span",{class:"token punctuation"},","),a(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
  `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
  `),n("span",{class:"token keyword"},"const"),a(" message "),n("span",{class:"token operator"},"="),a(" transaction"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"serializeMessage"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
  `),n("span",{class:"token keyword"},"const"),a(" signature "),n("span",{class:"token operator"},"="),a(" nacl"),n("span",{class:"token punctuation"},"."),a("sign"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"detached"),n("span",{class:"token punctuation"},"("),a("message"),n("span",{class:"token punctuation"},","),a(" payer"),n("span",{class:"token punctuation"},"."),a("secretKey"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
  transaction`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addSignature"),n("span",{class:"token punctuation"},"("),a("payer"),n("span",{class:"token punctuation"},"."),a("publicKey"),n("span",{class:"token punctuation"},","),a(" Buffer"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"from"),n("span",{class:"token punctuation"},"("),a("signature"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
  `),n("span",{class:"token keyword"},"const"),a(" rawTransaction "),n("span",{class:"token operator"},"="),a(" transaction"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"serialize"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
  `),n("span",{class:"token keyword"},"let"),a(" blockheight "),n("span",{class:"token operator"},"="),a(),n("span",{class:"token keyword"},"await"),a(" connection"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getBlockHeight"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`

  `),n("span",{class:"token keyword"},"while"),a(),n("span",{class:"token punctuation"},"("),a("blockheight "),n("span",{class:"token operator"},"<"),a(" lastValidBlockHeight"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
    connection`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"sendRawTransaction"),n("span",{class:"token punctuation"},"("),a("rawTransaction"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token punctuation"},"{"),a(`
      skipPreflight`),n("span",{class:"token operator"},":"),a(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),a(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
    `),n("span",{class:"token keyword"},"await"),a(),n("span",{class:"token function"},"sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
    blockheight `),n("span",{class:"token operator"},"="),a(),n("span",{class:"token keyword"},"await"),a(" connection"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getBlockHeight"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
  `),n("span",{class:"token punctuation"},"}"),a(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br"),n("span",{class:"line-number"},"45"),n("br"),n("span",{class:"line-number"},"46"),n("br"),n("span",{class:"line-number"},"47"),n("br"),n("span",{class:"line-number"},"48"),n("br"),n("span",{class:"line-number"},"49"),n("br"),n("span",{class:"line-number"},"50"),n("br"),n("span",{class:"line-number"},"51"),n("br"),n("span",{class:"line-number"},"52"),n("br"),n("span",{class:"line-number"},"53"),n("br"),n("span",{class:"line-number"},"54"),n("br")])],-1),ee=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"while"),a(),n("span",{class:"token punctuation"},"("),a("blockheight "),n("span",{class:"token operator"},"<"),a(" lastValidBlockHeight"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
  connection`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"sendRawTransaction"),n("span",{class:"token punctuation"},"("),a("rawTransaction"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token punctuation"},"{"),a(`
    skipPreflight`),n("span",{class:"token operator"},":"),a(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
  `),n("span",{class:"token keyword"},"await"),a(),n("span",{class:"token function"},"sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
  blockheight `),n("span",{class:"token operator"},"="),a(),n("span",{class:"token keyword"},"await"),a(" connection"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getBlockHeight"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),a(`
`),n("span",{class:"token punctuation"},"}"),a(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br")])],-1),se=a("Al consultar datos a trav\xE9s de "),oe=n("code",null,"getLatestBlockhash",-1),te=a(", las aplicaciones deben especificar su nivel de "),ce={href:"https://docs.solana.com/developing/clients/jsonrpc-api#configuring-state-commitment",target:"_blank",rel:"noopener noreferrer"},re=a("commitment (compromiso)"),ie=a(". Al establecer su compromiso en "),le=n("code",null,"confirmado",-1),de=a(" (votado) o "),pe=n("code",null,"finalizado",-1),ue=a(" (~30 bloques despu\xE9s de "),he=n("code",null,"confirmado",-1),_e=a("), una aplicaci\xF3n puede evitar consultar un blockhash de una bifurcaci\xF3n minoritaria."),me=a("Si una aplicaci\xF3n tiene acceso a nodos RPC detr\xE1s de un balanceador de carga, tambi\xE9n puede optar por dividir su carga de trabajo entre nodos espec\xEDficos. Los nodos RPC que atienden solicitudes de datos intensivos como "),be=a("getProgramAccounts"),ke=a(" pueden ser propensos a quedarse atr\xE1s y pueden no ser adecuados para reenviar transacciones. Para las aplicaciones que manejan transacciones sensibles al tiempo, puede ser prudente tener nodos dedicados que solo manejen "),fe=n("code",null,"sendTransaction",-1),ge=a("."),ve=c('<h3 id="el-costo-de-omitir-la-verificacion-previa" tabindex="-1"><a class="header-anchor" href="#el-costo-de-omitir-la-verificacion-previa" aria-hidden="true">#</a> El costo de omitir la verificaci\xF3n previa</h3><p>De forma predeterminada, <code>sendTransaction</code> realizar\xE1 tres comprobaciones previas antes de enviar una transacci\xF3n. Espec\xEDficamente, <code>sendTransaction</code> har\xE1 lo siguiente:</p><ul><li>Verificar que todas las firmas sean v\xE1lidas</li><li>Verifique que el blockhash referenciado est\xE9 dentro de los \xFAltimos 150 bloques</li><li>Simular la transacci\xF3n contra el slot del banco especificado por <code>preflightCommitment</code></li></ul><p>En el caso de que cualquiera de estas tres verificaciones previas falle, <code>sendTransaction</code> generar\xE1 un error antes de enviar la transacci\xF3n. Las comprobaciones previas a menudo pueden ser la diferencia entre perder una transacci\xF3n y permitir que un cliente maneje correctamente un error. Para garantizar que se tengan en cuenta estos errores comunes, se recomienda que los desarrolladores mantengan <code>skipPreflight</code> establecido en <code>false</code>.</p><h3 id="cuando-volver-a-firmar-transacciones" tabindex="-1"><a class="header-anchor" href="#cuando-volver-a-firmar-transacciones" aria-hidden="true">#</a> Cu\xE1ndo volver a firmar transacciones</h3><p>A pesar de todos los intentos de retransmisi\xF3n, puede haber momentos en los que un cliente deba volver a firmar una transacci\xF3n. Antes de volver a firmar cualquier transacci\xF3n, es <strong>muy importante</strong> asegurarse de que el blockhash de la transacci\xF3n inicial haya expirado. Si el blockhash inicial a\xFAn es v\xE1lido, es posible que la red acepte ambas transacciones. Para un usuario final, esto parecer\xEDa como si sin querer enviara la misma transacci\xF3n dos veces.</p>',6),ye=a("En Solana, una transacci\xF3n descartada por la red puede ser descartada de manera segura una vez que el blockhash al que hace referencia es m\xE1s antiguo que el "),qe=n("code",null,"lastValidBlock",-1),we=a(" recibido de "),Pe=n("code",null,"getRecentBlockhash",-1),Ce=a(". Los desarrolladores pueden verificar esto convenientemente para un blockhash dado a trav\xE9s de "),xe={href:"https://docs.solana.com/developing/clients/jsonrpc-api#isblockhashvalid",target:"_blank",rel:"noopener noreferrer"},Re=a("isBlockhashValid"),Te=a(". Una vez que se invalida un blockhash, los clientes pueden volver a firmar con un blockhash reci\xE9n consultado."),Le=n("h2",{id:"agradecimientos",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#agradecimientos","aria-hidden":"true"},"#"),a(" Agradecimientos")],-1),Se=a("Muchas gracias a Trent Nelson, "),je={href:"https://twitter.com/jacobvcreech",target:"_blank",rel:"noopener noreferrer"},Ee=a("Jacob Creech"),Be=a(", White Tiger, Le Yafo, "),ze={href:"https://twitter.com/buffalu__",target:"_blank",rel:"noopener noreferrer"},Ae=a("Buffalu"),Ue=a(" y "),Ve={href:"https://twitter.com/jito_labs",target:"_blank",rel:"noopener noreferrer"},He=a("Jito Labs"),De=a(" por su revisi\xF3n y comentarios.");function Ke(Ne,Oe){const s=o("ExternalLinkIcon"),r=o("SolanaCodeGroupItem"),i=o("SolanaCodeGroup"),l=o("RouterLink");return p(),u(h,null,[v,n("p",null,[y,n("a",q,[w,e(s)]),P]),C,n("ol",null,[n("li",null,[x,n("a",R,[T,e(s)])]),n("li",null,[L,n("a",S,[j,e(s)])])]),E,B,z,n("p",null,[A,U,V,n("a",H,[D,e(s)]),K]),n("p",null,[N,n("a",O,[M,e(s)]),I,n("a",J,[F,e(s)]),G,n("a",W,[Y,e(s)]),Q]),n("p",null,[X,n("a",Z,[$,e(s)]),nn]),n("ul",null,[n("li",null,[n("a",an,[en,e(s)])]),n("li",null,[n("a",sn,[on,e(s)])]),n("li",null,[n("a",tn,[cn,e(s)])]),n("li",null,[n("a",rn,[ln,e(s)])]),n("li",null,[n("a",dn,[pn,e(s)])])]),un,hn,n("ul",null,[n("li",null,[n("a",_n,[mn,e(s)]),bn]),n("li",null,[n("a",kn,[fn,e(s)]),gn]),n("li",null,[n("a",vn,[yn,e(s)]),qn])]),n("p",null,[wn,n("a",Pn,[Cn,e(s)]),xn]),Rn,Tn,Ln,n("p",null,[Sn,n("a",jn,[En,e(s)]),Bn,zn,An,n("a",Un,[Vn,e(s)]),Hn,Dn,Kn]),n("p",null,[Nn,n("a",On,[Mn,e(s)]),In,n("a",Jn,[Fn,e(s)]),Gn,Wn,Yn]),Qn,n("div",Xn,[Zn,$n,n("ul",null,[na,n("li",null,[aa,ea,sa,oa,n("ul",null,[ta,n("li",null,[ca,ra,ia,la,da,n("a",pa,[ua,e(s)]),ha]),_a,ma])])]),ba,n("ul",null,[n("li",null,[ka,fa,ga,va,n("a",ya,[qa,e(s)]),wa])])]),Pa,n("p",null,[Ca,xa,Ra,Ta,La,Sa,ja,n("a",Ea,[Ba,e(s)]),za]),n("p",null,[Aa,Ua,Va,n("a",Ha,[Da,e(s)]),Ka,n("a",Na,[Oa,e(s)]),Ma,Ia,Ja,n("a",Fa,[Ga,e(s)]),Wa,n("a",Ya,[Qa,e(s)]),Xa,n("a",Za,[$a,e(s)]),ne]),e(i,null,{default:t(()=>[e(r,{title:"TS",active:""},{default:t(()=>[ae]),preview:t(()=>[ee]),_:1})]),_:1}),n("p",null,[se,oe,te,n("a",ce,[re,e(s)]),ie,le,de,pe,ue,he,_e]),n("p",null,[me,e(l,{to:"/es/guides/get-program-accounts.html"},{default:t(()=>[be]),_:1}),ke,fe,ge]),ve,n("p",null,[ye,qe,we,Pe,Ce,n("a",xe,[Re,e(s)]),Te]),Le,n("p",null,[Se,n("a",je,[Ee,e(s)]),Be,n("a",ze,[Ae,e(s)]),Ue,n("a",Ve,[He,e(s)]),De])],64)}var Ie=d(g,[["render",Ke]]);export{Ie as default};
